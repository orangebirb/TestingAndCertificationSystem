@model List<TestingAndCertificationSystem.Registration>

@{
    List<UserIdentity> users = ViewBag.users;
    List<TestResults> results = ViewBag.results;
}

<div class="col-md-10">
    <h2>Tests attempts</h2>
</div>


@if (Model.Count() == 0)
{
    <div class="col-md-10">
        <div class="alert alert-info" role="alert">
            No attempts found
        </div>
    </div>
}
else
{
    <table class="table">
        <tr>
            <th>User</th>
            <th>Start time</th>
            <th>Status</th>
            <th>Mark</th>
            <th></th>
        </tr>
        @foreach (var attempt in Model)
        {
            <tr>
                <td>
                    @if (users != null)
                    {
                        <div>
                            @users.Where(x => x.Id == attempt.UserId).Select(x => x.FirstName).FirstOrDefault()
                        </div>
                    }
                </td>
                <td>@attempt.EntryTime</td>

                @if (results != null)
                {
                    var result = results.Where(x => x.RegistrationId == attempt.Id).FirstOrDefault();


                    @if (result != null)
                    {
                        <td>
                            @if (result.IsPassed == true)
                            {
                                <div class="alert alert-success" style="line-height: 30px; padding: 0px 15px;">
                                    Passed
                                </div>
                            }
                            else
                            {
                                <div class="alert alert-danger" style="line-height: 30px; padding: 0px 15px;">
                                    Failed
                                </div>
                            }
                        </td>

                        <td>
                            @result.FinalMarkInPercents%
                        </td>
                    }
                    else
                    {
                        <td>Failed to load data</td>
                        <td></td>
                    }

                    <td>
                        <form asp-controller="Tests" asp-action="AttemptInfopage" asp-route-registrationId="@attempt.Id">
                            <button type="submit" class="btn btn-sm btn-success"> Details </button>
                        </form>
                    </td>
                }
            </tr>
        }
    </table>
}